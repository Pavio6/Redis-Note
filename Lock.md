### 分布式锁
**分布式锁**是一种确保在分布式系统中，多个节点之间对共享资源进行互斥访问的机制。它确保在任意时刻，**只有一个**节点可以访问某个共享资源，从而防止并发冲突、数据不一致或竞态条件等问题。

#### 基于Redis的分布式锁
- **获取锁**
	- 互斥：确保只能有一个线程获取锁
	- 非阻塞：尝试一次，成功返回true，失败返回false
	- `SET lock thread1 NX EX 10` - NX是互斥，EX是超时时间
- **释放锁**
	- 手动释放：通过lua脚本来校验token再删除，避免误删
	- 超时释放：为锁添加一个超时时间

##### 基于setnx实现的分布式锁存在如下问题：
- **不可重入**：同一线程无法多次获取同一把锁
- **不可重试**：获取锁只尝试一次就返回false，没有重试机制
- **主从一致性**：Redis 主从复制通常是**异步**，主节点刚确认加锁就宕机、但锁还没复制到从节点；从节点被提升为主后，别人可能再次获得同一把锁，出现“同时持锁”的安全问题
